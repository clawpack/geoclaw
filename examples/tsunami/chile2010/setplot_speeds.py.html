<!-- **** DO NOT EDIT THIS FILE *** 
         This file was generated automatically from file
              setplot_speeds.py
         using $CLAW/clawutil/src/python/clawutil/clawcode2html.py         -->

<html>
<title> setplot_speeds.py.html </title>


          <head>
           <link rel="icon" href="http://clawpack.github.io//clawicon.ico" />
          </head> 
           <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000FF" 
                 VLINK="#5500DD" ALINK="#FF0000">
           <font FACE="HELVETICA,ARIAL">
           
<!-- Created from the file /Users/hudaqureshi/clawpack/geoclaw/examples/tsunami/chile2010/setplot_speeds.py -->
<!-- Date: Wed Jun 14 2017 at 13:29:06 -->

<table bgcolor="#FFEE99"> <tr> <td>
&nbsp;<font size=6> setplot_speeds.py.html </font> </td>

            <td><a href="http://clawpack.github.io/doc/index.html"><img
            src="http://clawpack.github.io//clawlogo.jpg"
            width=100 alt="CLAWPACK"></a>&nbsp;&nbsp; </td> </tr> <tr> <td>
&nbsp;Source file: &nbsp;&nbsp;<a href="setplot_speeds.py">setplot_speeds.py </a>
</td></tr><tr><td>
&nbsp;Directory:  &nbsp; /Users/hudaqureshi/clawpack/geoclaw/examples/tsunami/chile2010 
</td></tr><tr><td>
&nbsp;Converted:  &nbsp; Wed Jun 14 2017 at 13:29:06 
&nbsp; using <a href="http://clawpack.github.io//doc/application_documentation.html#clawcode2html">clawcode2html</a>
</td></tr><tr><td>
<font color="#BB3300"> &nbsp;This documentation file will 
not reflect any later changes in the source file. </font>
</td></tr></table></font>
<p>
<pre> 

""" 
Set up the plot figures, axes, and items to be done for each frame.

This module is imported by the plotting routines and then the
function setplot is called to set the plot parameters.
    
""" 

from __future__ import absolute_import
from __future__ import print_function
import numpy as np
import matplotlib.pyplot as plt

from clawpack.geoclaw import topotools
from six.moves import range

try:
    TG32412 = np.loadtxt('32412_notide.txt')
except:
    print("*** Could not load DART data file")


<font color="blue">#--------------------------</font>
def setplot(plotdata):
<font color="blue">#--------------------------</font>
    
    """ 
    Specify what is to be plotted at each frame.
    Input:  plotdata, an instance of pyclaw.plotters.data.ClawPlotData.
    Output: a modified version of plotdata.
    
    """ 


    from clawpack.visclaw import colormaps, geoplot
    from numpy import linspace

    plotdata.clearfigures()  <font color="blue"># clear any old figures,axes,items data</font>


    <font color="blue"># To plot gauge locations on pcolor or contour plot, use this as</font>
    <font color="blue"># an afteraxis function:</font>

    def addgauges(current_data):
        from clawpack.visclaw import gaugetools
        gaugetools.plot_gauge_locations(current_data.plotdata, \
             gaugenos='all', format_string='ko', add_labels=True)
    
    <font color="blue"># ========================================================================</font>
    <font color="blue">#  Water helper functions</font>
    <font color="blue"># ========================================================================</font>
    def b(cd):
        return cd.q[3,:,:] - cd.q[0,:,:]
        
    def extract_eta(h,eta,DRY_TOL=10**-3):
        index = np.nonzero((np.abs(h) < DRY_TOL) + (h == np.nan))
        eta[index[0],index[1]] = np.nan
        return eta
    
    def extract_velocity(h,hu,DRY_TOL=10**-8):
        u = np.zeros(hu.shape)
        index = np.nonzero((np.abs(h) > DRY_TOL) * (h != np.nan))
        u[index[0],index[1]] = hu[index[0],index[1]] / h[index[0],index[1]]
        return u
    
    def eta(cd):
        return extract_eta(cd.q[0,:,:],cd.q[3,:,:])
        
    def water_u(cd):
        return extract_velocity(cd.q[0,:,:],cd.q[1,:,:])
        
    def water_v(cd):
        return extract_velocity(cd.q[0,:,:],cd.q[2,:,:])
        
    def water_speed(current_data):
        u = water_u(current_data)
        v = water_v(current_data)
            
        return np.sqrt(u**2+v**2)


    <font color="blue">#-----------------------------------------</font>
    <font color="blue"># Figure for surface</font>
    <font color="blue">#-----------------------------------------</font>
    plotfigure = plotdata.new_plotfigure(name='Surface', figno=0)

    <font color="blue"># Set up for axes in this figure:</font>
    plotaxes = plotfigure.new_plotaxes('pcolor')
    plotaxes.title = 'Surface'
    plotaxes.scaled = True

    def fixup(current_data):
        import pylab
        addgauges(current_data)
        t = current_data.t
        t = t / 3600.  <font color="blue"># hours</font>
        pylab.title('Surface at %4.2f hours' % t, fontsize=20)
        pylab.xticks(fontsize=15)
        pylab.yticks(fontsize=15)
    plotaxes.afteraxes = fixup

    <font color="blue"># Water</font>
    plotitem = plotaxes.new_plotitem(plot_type='2d_pcolor')
    <font color="blue">#plotitem.plot_var = geoplot.surface</font>
    plotitem.plot_var = geoplot.surface_or_depth
    plotitem.pcolor_cmap = geoplot.tsunami_colormap
    plotitem.pcolor_cmin = -0.2
    plotitem.pcolor_cmax = 0.2
    plotitem.add_colorbar = True
    plotitem.amr_celledges_show = [0,0,0]
    plotitem.patchedges_show = 1

    <font color="blue"># Land</font>
    plotitem = plotaxes.new_plotitem(plot_type='2d_pcolor')
    plotitem.plot_var = geoplot.land
    plotitem.pcolor_cmap = geoplot.land_colors
    plotitem.pcolor_cmin = 0.0
    plotitem.pcolor_cmax = 100.0
    plotitem.add_colorbar = False
    plotitem.amr_celledges_show = [1,1,0]
    plotitem.patchedges_show = 1
    plotaxes.xlimits = [-120,-60]
    plotaxes.ylimits = [-60,0]

    <font color="blue"># add contour lines of bathy if desired:</font>
    plotitem = plotaxes.new_plotitem(plot_type='2d_contour')
    plotitem.show = False
    plotitem.plot_var = geoplot.topo
    plotitem.contour_levels = linspace(-3000,-3000,1)
    plotitem.amr_contour_colors = ['y']  <font color="blue"># color on each level</font>
    plotitem.kwargs = {'linestyles':'solid','linewidths':2}
    plotitem.amr_contour_show = [1,0,0]  
    plotitem.celledges_show = 0
    plotitem.patchedges_show = 0

    <font color="blue">#-----------------------------------------</font>
    <font color="blue"># Figure for velocities</font>
    <font color="blue">#-----------------------------------------</font>
    plotfigure = plotdata.new_plotfigure(name='Speeds', figno=1)

    <font color="blue"># Set up for axes in this figure:</font>
    plotaxes = plotfigure.new_plotaxes('speeds')
    plotaxes.title = 'Speeds'
    plotaxes.scaled = True

    def fixup(current_data):
        import pylab
        addgauges(current_data)
        t = current_data.t
        t = t / 3600.  <font color="blue"># hours</font>
        pylab.title('Speeds at %4.2f hours' % t, fontsize=20)
        pylab.xticks(fontsize=15)
        pylab.yticks(fontsize=15)
    plotaxes.afteraxes = fixup

    <font color="blue"># Speed</font>
    plotitem = plotaxes.new_plotitem(plot_type='2d_pcolor')
    plotitem.plot_var = water_speed
    plotitem.pcolor_cmap = plt.get_cmap('PuBu')
    plotitem.pcolor_cmin = 0.0
    plotitem.pcolor_cmax = 0.01
    plotitem.add_colorbar = True
    plotitem.amr_celledges_show = [0,0,0]
    plotitem.patchedges_show = 1

    <font color="blue"># Land</font>
    plotitem = plotaxes.new_plotitem(plot_type='2d_pcolor')
    plotitem.plot_var = geoplot.land
    plotitem.pcolor_cmap = geoplot.land_colors
    plotitem.pcolor_cmin = 0.0
    plotitem.pcolor_cmax = 100.0
    plotitem.add_colorbar = False
    plotitem.amr_celledges_show = [1,1,0]
    plotitem.patchedges_show = 1
    plotaxes.xlimits = [-120,-60]
    plotaxes.ylimits = [-60,0]


    <font color="blue">#-----------------------------------------</font>
    <font color="blue"># Figures for gauges</font>
    <font color="blue">#-----------------------------------------</font>
    plotfigure = plotdata.new_plotfigure(name='Surface at gauges', figno=300, \
                    type='each_gauge')
    plotfigure.clf_each_gauge = True

    <font color="blue"># Set up for axes in this figure:</font>
    plotaxes = plotfigure.new_plotaxes()
    plotaxes.xlimits = 'auto'
    plotaxes.ylimits = 'auto'
    plotaxes.title = 'Surface'

    <font color="blue"># Plot surface as blue curve:</font>
    plotitem = plotaxes.new_plotitem(plot_type='1d_plot')
    plotitem.plot_var = 3
    plotitem.plotstyle = 'b-'

    <font color="blue"># Plot topo as green curve:</font>
    plotitem = plotaxes.new_plotitem(plot_type='1d_plot')
    plotitem.show = False

    def gaugetopo(current_data):
        q = current_data.q
        h = q[0,:]
        eta = q[3,:]
        topo = eta - h
        return topo
        
    <font color="blue"># plotitem.plot_var = gaugetopo</font>
    <font color="blue"># plotitem.plotstyle = 'g-'</font>

    def add_zeroline(current_data):
        from pylab import plot, legend, xticks, floor, axis, xlabel
        t = current_data.t 
        gaugeno = current_data.gaugeno

        if gaugeno == 32412:
            try:
                plot(TG32412[:,0], TG32412[:,1], 'r')
                legend(['GeoClaw','Obs'],'lower right')
            except: pass
            axis((0,t.max(),-0.3,0.3))

        plot(t, 0*t, 'k')
        n = int(floor(t.max()/3600.) + 2)
        xticks([3600*i for i in range(n)], ['%i' % i for i in range(n)])
        xlabel('time (hours)')

    plotaxes.afteraxes = add_zeroline



    <font color="blue">#-----------------------------------------</font>
    
    <font color="blue"># Parameters used only when creating html and/or latex hardcopy</font>
    <font color="blue"># e.g., via pyclaw.plotters.frametools.printframes:</font>

    plotdata.printfigs = True                <font color="blue"># print figures</font>
    plotdata.print_format = 'png'            <font color="blue"># file format</font>
    plotdata.print_framenos = 'all'          <font color="blue"># list of frames to print</font>
    plotdata.print_gaugenos = 'all'          <font color="blue"># list of gauges to print</font>
    plotdata.print_fignos = 'all'            <font color="blue"># list of figures to print</font>
    plotdata.html = True                     <font color="blue"># create html files of plots?</font>
    plotdata.html_homelink = '../README.html'   <font color="blue"># pointer for top of index</font>
    plotdata.latex = True                    <font color="blue"># create latex file of plots?</font>
    plotdata.latex_figsperline = 2           <font color="blue"># layout of plots</font>
    plotdata.latex_framesperline = 1         <font color="blue"># layout of plots</font>
    plotdata.latex_makepdf = False           <font color="blue"># also run pdflatex?</font>

    return plotdata

</pre></html>
